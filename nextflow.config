// Need to make sure that the value in the errorStrategy matches maxRetries
process {
    executor = 'awsbatch'
    errorStrategy = { task.attempt <= 2 ? 'retry' : 'finish' }
    maxRetries = 2

    withLabel: small_process {
        cpus = 2
        memory = 2.GB
        queue = 'hakmonkey-small_process'
    }

    withLabel: medium_process {
        cpus = 8
        memory = 14.GB
        queue = 'hakmonkey-medium_process'
    }

    withLabel: high_mem {
        cpus = 8
        memory = 62.GB
        queue = 'hakmonkey-high_mem'
    }

    withLabel: alignment {
        cpus = 32
        memory = 62.GB
        queue = 'hakmonkey-alignment'
    }

    withLabel: ubuntu_python3 {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/ubuntu_python3-ufl-germline:1.0.0'
    }

    withLabel: bcftools_tabix {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/bcftools_tabix-ufl-germline:1.0.0'
    }

    withLabel: bwa {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/bwa-ufl-germline:1.0.0'
    }

    withLabel: expansion_hunter {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/expansion_hunter-ufl-germline:1.0.0'
    }

    withLabel: fastqc {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/fastqc-ufl-germline:1.0.0'
    }

    withLabel: cn_mops {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/panelcn.mops-ufl-germline:1.0.0'
    }

    withLabel: picard {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/picard-ufl-germline:1.0.0'
    }

    withLabel: samtools {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/samtools-ufl-germline:1.0.0'
    }

    withLabel: snpeff_tabix {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/snpeff_tabix-ufl-germline:1.0.0'
    }

    withLabel: strelka2 {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/strelka2-ufl-germline:1.0.0'
    }

    withLabel: trimmomatic {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/trimmomatic-ufl-germline:1.0.0'
    }

    withLabel: multiqc {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/multiqc-ufl-germline:1.0.0'
    }

    withLabel: manta {
        container = '178175818611.dkr.ecr.us-east-1.amazonaws.com/manta-ufl-germline:1.0.0'
    }
}

aws {
    region = 'us-east-1'

    client {
        maxErrorRetry = 4
    }

    batch {
        maxTransferAttempts = 8
        delayBetweenAttempts = 300
        maxParallelTransfers = 5
    }
}

docker {
    enabled = true
}

timeline {
    enabled = true
}

trace {
    enabled = true
    fields = 'process,tag,status,container,cpus,disk,memory,attempt,submit,start,complete,realtime,%cpu,%mem'
}

manifest {
    author = 'Johnny Bravo'
    description = 'germline pipeline and some tertiary analysis'
    version = '1.0.0'
}