<!DOCTYPE html>
<html lang="en">
<head>
    <title>GatorGenome</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto&family=Roboto+Mono:wght@600&display=swap">
    <link rel="stylesheet" href="css/stylesheet.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.quicksearch.js"></script>
    <script src="js/jquery.multi-select.js"></script>
    <script src="js/aws-sdk-2.888.0.min.js"></script>
    <script src="js/aws-cognito-sdk.min.js"></script>
    <script src="js/amazon-cognito-identity.min.js"></script>
    <script src="js/log_in.js"></script>
    <script src="js/pipeline_launch.js"></script>
    <script src="js/var_class_launch.js"></script>
    <script src="js/file_request.js"></script>
    <script src="js/context.js"></script>
</head>
<body>
    <div class="body-img"></div>

    <div class="body-div">
        
        <div class="banner" id="banner">

            <div class="banner-img"></div>

            <img src="img/uf_health_logo.png" id="uf_health_logo">
            <div class="nav-main">
                <a class="ctsi" href="https://www.ctsi.ufl.edu/">CTSI</a>
                <a class="lnn" href="https://neurology.ufl.edu/divisions/lnn/">LNN</a>
                <a class="test1">TEST</a>
                <a class="test2">TEST</a>
                <a class="test3">TEST</a>
                <a class="test4">TEST</a>
            </div>
            <button id="log_out_button" onclick="logOut()" style="display:none;">Log Out</button>
        </div>

        <div class="content" id="main-content">

            <div class="content-bg"></div>

            <div id="log_in_box" class="centered">
                <input id="userNameInput" type="text" placeholder="Username"/></br>
                <input id="passwordInput" type="password" placeholder="Password"/></br>
                <button id="logInButton" value="Log In" onclick="logIn()">Log In</button>
            </div>

            <div id="menu" class="menu" style="display:none">

                <div id="pipeline" class="menu-child">
                    <button id="pipeline_card" class="card">
                        Pipeline
                        <span>
                            <br/>
                            Click here to begin making selections for a germline or multiqc run.
                        </span>
                    </button>
                </div>

                <div id="report" class="menu-child">
                    <button id="report_card" class="card">
                        Reporting
                        <span>
                            <br/>
                            Click here to request a research report for any/ none of the provided panels.
                        </span>
                    </button>
                </div>

                <div id="request" class="menu-child">
                    <button id="request_card" class="card">
                        Requests
                        <span>
                            <br/>
                            Click here to request the raw VCF, MultiQC report on a run, or reports that have already been generated for a specific sample.
                        </span>
                    </button>
                </div>
                
                <div id="documentation" class="menu-child">
                    <button id="documentation_card" class="card">
                        Documentation
                        <span>
                            <br/>
                            Click here to view the documentation on the pipeline.
                        </span>
                    </button>
                </div>

                <div id="test" class="menu-child">
                    <button id="test_card" class="card">
                        TEST
                        <span>
                            <br/>
                            Click here to go to the test environment.
                        </span>
                    </button>
                </div>

            </div>

            <div id="loader" class="loader" style="display:none">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>

            <div id="workflow_question_box" class="centered question-container" style="display:none">
                <button class="back" onclick="switchToLoggedInView()"></button>
                <div class="text-box" id="workflow_text">
                    <p class="statement" id="workflow_statement">Is this a germline run or a multiqc run?</p>
                    <label>
                        <input type="radio" class="choices" name="workflow" id="germline"> GERMLINE pipeline
                        <br/><br/>
                    </label>
                    <label>
                        <input type="radio" class="choices" name="workflow" id="multiqc"> MULTIQC for run
                        <br/><br/>
                    </label>
                </div>
                <button onclick="get_workflow()" id="workflow_button">Get Runs</button>
            </div>

            <div id="exome_question_box" class="centered question-container" style="display:none">
                <button class="back" onclick="switchToPipelineView()"></button>
                <div class="text-box" id="exome_text">
                    <p class="statement" id="exome_statement">Is this an exome run or a whole genome run?</p>
                    <label>
                        <input type="radio" class="choices" name="exome" id="WGS"> WGS [genome]
                        <br/><br/>
                    </label>
                    <label>
                        <input type="radio" class="choices" name="exome" id="WES"> WES [exome]
                        <br/><br/>
                    </label>
                    
                </div>
                <button onclick="get_type()" id="exome_button">Submit</button>
            </div>

            <div id="runs_box" class="centered question-container" style="display:none">
                <button class="back" id="run_box_back"></button>
                <div class="text-box" id="runs_text">
                    <p class="statement" id="runs_statement">Select the run to process in the pipeline.</p>
                    <div class="choices" id="runs_list"></div>
                </div>
            </div>

            <div id="lane_box" class="centered question-container" style="display:none">
                <button class="back" onclick="switchToRunIdView()"></button>
                <div class="text-box" id="lane_text">
                    <p class="statement" id="lane_statement">Is this run single-lane or multi-lane run?</p>
                    <label>
                        <input type="radio" class="choices" name="lanes" id="single"> NextSeq [Single Lane]
                        <br/><br/>
                    </label>
                    <label>
                        <input type="radio" class="choices" name="lanes" id="multi"> NovaSeq [Multi Lane]
                        <br/><br/>
                    </label>
                </div>
                <button onclick="get_match()" id="lane_button">Submit</button>
            </div>

            <div id="match_box" class="centered question-container" style="display:none">
                <button class="back" onclick="switchToLaneView()"></button>
                <div class="text-box" id="match_text">
                    <p class="statement" id="match_statement">Select the correct matching pattern.</p>
                    <label>
                        <input type="radio" class="choices" name="match" id="match_one"> Illumina: [_{R1,R2}_001.fastq.gz]
                        <br/><br/>
                    </label>
                    <label>
                        <input type="radio" class="choices" name="match" id="match_two"> Other: [_{1,2}.fq.gz]
                        <br/>
                    </label>
                    <label class="choices" id="other_match_label" for="other_match">Custom: </label>
                    <input type="text" name="match" id="other_match" placeholder="_{x,y}.fq/fastq.gz"/>
                    <br/><br/>
                </div>
                <button onclick="set_match()" id="match_button">Submit</button>
            </div>

            <div id="command_box" class="centered question-container" style="display:none">
                <button class="back" id="command_back"></button>
                <div class="text-box" id="command_text">
                    <p class="statement" id="command_statement">Confirm choices, then launch pipeline.</p>
                    <div class="centered" id="germline_command" style="display:none">
                        <table class="germline-table" id="germline_table">
                            <tr>
                                <th>Variable</th>
                                <th>Value</th>
                                <th>Return Button</th>
                            </tr>
                            <tr>
                                <td>Workflow</td>
                                <td id="workflow_cell"></td>
                                <td>
                                    <input type="button" class="table-button" onclick="switchToPipelineView()" value="Change Workflow"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Type</td>
                                <td id="type_cell"></td>
                                <td>
                                    <input type="button" class="table-button" onclick="switchToTypeView()" value="Change Type"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Run ID</td>
                                <td id="run_id_cell"></td>
                                <td>
                                    <input type="button" class="table-button" onclick="switchToRunIdView()" value="Change Run ID"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Single Lane</td>
                                <td id="lane_cell"></td>
                                <td>
                                    <input type="button" class="table-button" onclick="switchToLaneView()" value="Change Lanes"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Match Pattern</td>
                                <td id="match_cell"></td>
                                <td>
                                    <input type="button" class="table-button" onclick="switchToMatchView()" value="Change Match"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div id="multiqc_command" style="display:none">
                        <table class="qc-table" id="multiqc_table">
                            <tr>
                                <th>Variable</th>
                                <th>Value</th>
                                <th>Return Button</th>
                            </tr>
                            <tr>
                                <td>Workflow</td>
                                <td id="qc_workflow_cell"></td>
                                <td>
                                    <input type="button" class="table-button" onclick="switchToPipelineView()" value="Change Workflow"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Run ID</td>
                                <td id="qc_run_id_cell"></td>
                                <td>
                                    <input type="button" class="table-button" onclick="switchToRunIdView()" value="Change Run ID"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <input type="submit" onclick="launch_pipeline()" id="launch_command_button" value="Launch Pipeline"/>
            </div>

            <div id="report_runs_box" class="centered question-container" style="display:none">
                <button class="back" onclick="switchToLoggedInView()"></button>
                <div class="text-box" id="report_runs_text">
                    <p class="statement" id="report_runs_statement">Select the run to process in the pipeline.</p>
                    <div class="choices" id="report_runs_list"></div> 
                </div>
                <button onclick="get_report_sample()" id="samples_button">Get Samples</button>
            </div>

            <button id="report_selection_back" class="back" onclick="switchToReportView()" style="display:none"></button>
            <div id="report_selection" class="centered question-container" style="display:none">
                <div id="report_sample_box" class="text-box" style="display:none">
                    <p id="sample_title" class="statement">Sample/Panel Selection:</p>
                    <div id="samples" class="flex-container">
                        <div id="parent_selector_box" class="flex-child">
                            <div id="parent_selector_child_box" class="flex-child-child">
                                <select multiple="multiple" id="parent_selector"></select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="report_email_box" class="centered">
                <form id="email" onsubmit="return false;" style="display:none">
                    <div class="centered">
                        <label id="user_email_label" for="user_email">Email: </label>
                        <input type="email" id="user_email" name="User_Email" placeholder="gator@ufl.edu">
                        <br/><br/>
                        <input type="submit" onclick="launch_reporting()" id="launch_report_button" value="Get Research Report">
                    </div>
                </form>
            </div>

            <div id="request_runs_box" class="centered question-container" style="display:none;">
                <button class="back" onclick="switchToLoggedInView()"></button>
                <div class="text-box" id="request_runs_text">
                    <p class="statement" id="request_runs_statement">Select the correct run for your report(s).</p>
                    <div class="choices" id="request_runs_list"></div>
                </div>
                <button onclick="switch_to_contexts()" id="">Submit</button>
            </div>

            <div id="request_run_or_sample_box" class="centered question-container" style="display:none;">
                <button class="back" onclick="switchToRequestView()"></button>
                <div class="text-box" id="request_run_or_sample_text">
                    <p class="statement" id="request_run_or_sample_statement">Would you like a sample report or the MultiQC report for a run?</p>
                    <label>
                        <input type="radio" class="choices" name="r_or_s" id="sample"> Report for a sample
                        <br/><br/>
                    </label>
                    <label>
                        <input type="radio" class="choices" name="r_or_s" id="run"> MultiQC report for run
                        <br/><br/>
                    </label>
                </div>
                <button onclick="r_or_s()" id="request_r_or_s_button">Submit</button>
            </div>

            <div id="request_samples_box" class="centered question-container" style="display:none;">
                <button class="back" onclick="switchToRunOrSampleView()"></button>
                <div class="text-box" id="request_samples_text">
                    <p class="statement" id="request_samples_statement">Select your sample.</p>
                    <div class="choices" id="request_samples"></div>
                </div>
                <button onclick="get_chosen_request_sample()" id="request_samples_button">Submit</button>
            </div>

            <div id="request_reports_box" class="centered question-container" style="display:none;">
                <button class="back" onclick="switchToRequestSamplesView()"></button>
                <div class="text-box" id="request_reports_text">
                    <p class="statement" id="request_reports_statement">Select the report/ file you would like.</p>
                    <div class="choices" id="request_reports"></div>
                </div>
                <button onclick="get_request_email()" id="request_reports_button">Submit</button>
            </div>

            <div id="request_email_box" class="centered question-container" style="display:none;">
                <button class="back" onclick="switchToRequestReportsView()"></button>
                <div class="text-box" id="request_email_text">
                    <p class="statement" id="request_email_statement">Please enter your email.</p>
                    <form id="email" onsubmit="return false;">
                        <div class="centered">
                            <label id="request_user_email_label" for="request_user_email">Email: </label>
                            <input type="email" id="request_user_email" name="User_Email" placeholder="gator@ufl.edu">
                            <br/><br/>
                            <input type="submit" onclick="retrieve_report()" id="launch_report_button" value="Get Research Report">
                        </div>
                    </form>
                </div>
            </div>

            <div class="centered" id="launch_img" style="display:none">
                <img src="img/launch.png">
            </div>

            <div class="centered" id="test-env" style="display:none">
                <div class="normal">
                    <input id="normal" type="checkbox"/>
                    <label class="toggle-item" for="normal"></label>
                </div>
            </div>

            <div class="flex-img-container" style="display: none;">
                <div class="flex-img-child">
                    <img src="img/ClinicalTransScienceInst.png" id="uf_logo">
                </div>
                <div class="flex-img-child">
                    <img src="img/gator_good.png" id="gator_good">
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">getCurrentLoggedInSession();</script>

    <script id="blur_unfocused_elements" type="text/javascript">
        $(function() {
            var timesClicked = 0;
            if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
                $('.body-div').on('click tap', function() {
                    if(timesClicked > 0) {
                        console.log('body greater');
                        console.log(timesClicked);
                        $('.body-img').removeClass('blur');
                        $('.banner').removeClass('blur');
                        $('.content-bg').removeClass('blur');
                        $('.flex-img-container').removeClass('blur');
                        $('.menu-child').removeClass('blur');
                        timesClicked--;
                        return;
                    } else {
                        $('.body-div .card').on('click tap', function() {
                            if(timesClicked == 0) {
                                console.log('equal zero');
                                console.log(timesClicked);
                                $('.body-img').addClass('blur');
                                $('.banner').addClass('blur');
                                $('.content-bg').addClass('blur');
                                $('.flex-img-container').addClass('blur');
                                $('.menu-child').addClass('blur');
                                $(this).parent().removeClass('blur');
                                timesClicked++;
                                return;
                            }
                        });
                    }
                });
            } else {
                $('.body-div .card').hover(function() {
                    $('.body-img').addClass('blur');
                    $('.banner').addClass('blur');
                    $('.content-bg').addClass('blur');
                    $('.flex-img-container').addClass('blur');
                    $('.menu-child').addClass('blur');
                    $(this).parent().removeClass('blur');
                }, function() {
                    $('.body-img').removeClass('blur');
                    $('.banner').removeClass('blur');
                    $('.content-bg').removeClass('blur');
                    $('.flex-img-container').removeClass('blur');
                    $('.menu-child').removeClass('blur');
                });
            }
        });
    </script>

    <script id="mobile_pipeline_card_interaction" type="text/javascript">
        var pipelineTimesClicked = 0;
        $("#pipeline_card").click(function() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                setTimeout(function() {pipelineTimesClicked = 0;}, 4000);
                pipelineTimesClicked++;
                if (pipelineTimesClicked>1) {
                    switchToPipelineView();
                }
            } else {
                switchToPipelineView();
            }
        });
    </script>

    <script id="mobile_report_card_interaction" type="text/javascript">
        var reportTimesClicked = 0;
        $("#report_card").click(function() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                setTimeout(function() {reportTimesClicked = 0;}, 4000);
                reportTimesClicked++;
                if (reportTimesClicked>1) {
                    switchToReportView();
                }
            } else {
                switchToReportView();
            }
        });
    </script>

    <script id="mobile_request_card_interaction" type="text/javascript">
        var requestTimesClicked = 0;
        $("#request_card").click(function() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                setTimeout(function() {requestTimesClicked = 0;}, 4000);
                requestTimesClicked++;
                if (requestTimesClicked>1) {
                    switchToRequestView();
                }
            } else {
                switchToRequestView();
            }
        });
    </script>

    <script id="mobile_documentation_card_interaction" type="text/javascript">
        var documentationTimesClicked = 0;
        $("#documentation_card").click(function() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                documentationTimesClicked++;
                setTimeout(function() {documentationTimesClicked = 0;}, 4000);
                if (documentationTimesClicked>1) {
                    switchToDocumentationView();
                }
            } else {
                switchToDocumentationView();
            }
        });
    </script>

    <script id="mobile_test_card_interaction" type="text/javascript">
        var testTimesClicked = 0;
        $("#test_card").click(function() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                setTimeout(function() {testTimesClicked = 0;}, 4000);
                testTimesClicked++;
                if (testTimesClicked>1) {
                    testView();
                }
            } else {
                testView();
            }
        });
    </script>

</body>
</html>